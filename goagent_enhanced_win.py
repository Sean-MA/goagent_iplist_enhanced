#! /usr/bin/env python
#coding:utf-8

import sys
import re
import urllib2
import urllib
import requests
import cookielib

## 这段代码是用于解决中文报错的问题  
#reload(sys)  
#sys.setdefaultencoding("utf8")  
#####################################################
print "Goagent Iplist Auto-Update Tool version 0.1\n"
signin_url = "http://www.firefoxfan.com/wp-login.php"

logininfo = {"log": "ma.xiaoyuan.mail@gmail.com",
             "pwd": "maxiaoyuan1234",
             "wp-submit": "登录"
             }
 
user_agent = ("Mozilla/5.0 (Windows NT 5.1) "
              "AppleWebKit/537.36 (KHTML, like Gecko) "
              "Chrome/41.0.2272.118 Safari/537.36")

post_headers = {"User-Agent": user_agent,
                "Referer": "http://www.firefoxfan.com/wp-login.php"
                }
firefoxfan_session = requests.Session()

login_res = firefoxfan_session.post(signin_url,
                                  data=logininfo,
                                  headers=post_headers,
                                  )
print "Login...\n"
if login_res.status_code == 200:
    print "Login Successfully!\n"
else:
    print login_res.text


from bs4 import BeautifulSoup
webpage = urllib2.urlopen('http://www.firefoxfan.com/firefox-gaogent/goagent-ip.html')
soup = BeautifulSoup(webpage)
f = open('out.txt', 'w')
for anchor in soup.find_all('span', class_ ='crayon-cn'):
    print >> f, anchor.contents
else:
    f.close()
import re
f1 = open('out.txt')
f2 = open('out1.txt','w')
f2.close()
f2 = open('out1.txt','r+')
for s in f1.readlines():
    f2.write(s.replace("[u'",''))
f1.close()
f2.close()
f1 = open('out1.txt')
f2 = open('out2.txt','w')
f2.close()
f2 = open('out2.txt','r+')
for s in f1.readlines():
    f2.write(s.replace("']\n",'|'))
f2.seek(-1,2)
f2.write('\n')
f2.close()
f1.close()

f2 = open('out2.txt','r+')
iplist = f2.read()
f2.close()
f1 = open('proxy.ini', 'r+')
#f1 = open('E:\Program Files\goagent-goagent-98eca96\local\proxy.ini', 'r+')
source = f1.read()
pos = source.find("google_cn",source.find("[iplist]"))+len("google_cn")
pos1 = source.find("google_hk",pos)
source = source[:pos] + " = 173.194.215.115|173.194.215.96|74.125.139.201|74.125.134.201|173.194.215.139|173.194.215.199|64.233.168.200|173.194.215.93|173.194.215.123|173.194.215.103|173.194.215.83|74.125.198.201|64.233.188.190|64.233.188.18|64.233.188.96|64.233.162.84|64.233.188.148|64.233.188.104|64.233.188.156|64.233.188.154|64.233.188.98|74.125.237.7|64.233.188.191|64.233.188.189|64.15.114.37|173.194.218.85|173.194.218.164|64.233.188.19|173.194.218.147|173.194.218.91|74.125.237.37|74.125.237.59|74.125.237.11|74.125.237.35|64.233.188.112|173.194.218.195|173.194.218.123|64.233.162.85|173.194.218.17|178.45.251.114|74.125.237.35|64.233.188.105|64.233.188.155|64.233.188.145|74.125.237.26|64.233.188.156|74.125.237.40|74.125.237.63|64.15.114.36|173.194.218.155|64.233.188.200|64.233.188.198|64.15.114.49|74.125.237.15|64.233.188.138|74.125.237.9|64.233.188.146|74.125.237.45|173.194.218.102|64.233.188.31|64.233.188.99|64.233.188.154|74.125.237.31|74.125.237.13|74.125.237.62|74.125.237.4|64.233.188.19|64.233.188.114|64.233.188.139|173.194.218.142|173.194.218.201|64.233.188.101|64.233.188.90|173.194.218.17|173.194.218.86|64.233.188.167|173.194.218.197|74.125.237.36|64.233.188.147|173.194.218.138|74.125.237.8|173.194.218.137|64.233.188.112|173.194.218.122|64.233.188.115|64.233.188.82|64.233.162.83|64.15.114.42|64.233.188.86|74.125.237.11|64.15.114.46|64.233.188.195|64.233.188.102|173.194.218.115|64.233.188.100|173.194.218.166|64.15.114.51|64.233.188.97|74.125.237.27|64.233.188.141|173.194.218.19|74.125.237.58|64.233.188.93|173.194.218.99|74.125.237.25|64.233.188.122" + iplist + source[pos1:]
pos = source.find("google_hk",source.find("[iplist]"))+len("google_hk")
pos1 = source.find("google_talk",pos)
source = source[:pos] + " = 173.194.215.115|173.194.215.96|74.125.139.201|74.125.134.201|173.194.215.139|173.194.215.199|64.233.168.200|173.194.215.93|173.194.215.123|173.194.215.103|173.194.215.83|74.125.198.201|64.233.188.190|64.233.188.18|64.233.188.96|64.233.162.84|64.233.188.148|64.233.188.104|64.233.188.156|64.233.188.154|64.233.188.98|74.125.237.7|64.233.188.191|64.233.188.189|64.15.114.37|173.194.218.85|173.194.218.164|64.233.188.19|173.194.218.147|173.194.218.91|74.125.237.37|74.125.237.59|74.125.237.11|74.125.237.35|64.233.188.112|173.194.218.195|173.194.218.123|64.233.162.85|173.194.218.17|178.45.251.114|74.125.237.35|64.233.188.105|64.233.188.155|64.233.188.145|74.125.237.26|64.233.188.156|74.125.237.40|74.125.237.63|64.15.114.36|173.194.218.155|64.233.188.200|64.233.188.198|64.15.114.49|74.125.237.15|64.233.188.138|74.125.237.9|64.233.188.146|74.125.237.45|173.194.218.102|64.233.188.31|64.233.188.99|64.233.188.154|74.125.237.31|74.125.237.13|74.125.237.62|74.125.237.4|64.233.188.19|64.233.188.114|64.233.188.139|173.194.218.142|173.194.218.201|64.233.188.101|64.233.188.90|173.194.218.17|173.194.218.86|64.233.188.167|173.194.218.197|74.125.237.36|64.233.188.147|173.194.218.138|74.125.237.8|173.194.218.137|64.233.188.112|173.194.218.122|64.233.188.115|64.233.188.82|64.233.162.83|64.15.114.42|64.233.188.86|74.125.237.11|64.15.114.46|64.233.188.195|64.233.188.102|173.194.218.115|64.233.188.100|173.194.218.166|64.15.114.51|64.233.188.97|74.125.237.27|64.233.188.141|173.194.218.19|74.125.237.58|64.233.188.93|173.194.218.99|74.125.237.25|64.233.188.122" + iplist + source[pos1:]
pos = source.find("google_talk",source.find("[iplist]"))+len("google_talk")
pos1 = source.find("[",pos)
source = source[:pos] + " = 173.194.215.115|173.194.215.96|74.125.139.201|74.125.134.201|173.194.215.139|173.194.215.199|64.233.168.200|173.194.215.93|173.194.215.123|173.194.215.103|173.194.215.83|74.125.198.201|64.233.188.190|64.233.188.18|64.233.188.96|64.233.162.84|64.233.188.148|64.233.188.104|64.233.188.156|64.233.188.154|64.233.188.98|74.125.237.7|64.233.188.191|64.233.188.189|64.15.114.37|173.194.218.85|173.194.218.164|64.233.188.19|173.194.218.147|173.194.218.91|74.125.237.37|74.125.237.59|74.125.237.11|74.125.237.35|64.233.188.112|173.194.218.195|173.194.218.123|64.233.162.85|173.194.218.17|178.45.251.114|74.125.237.35|64.233.188.105|64.233.188.155|64.233.188.145|74.125.237.26|64.233.188.156|74.125.237.40|74.125.237.63|64.15.114.36|173.194.218.155|64.233.188.200|64.233.188.198|64.15.114.49|74.125.237.15|64.233.188.138|74.125.237.9|64.233.188.146|74.125.237.45|173.194.218.102|64.233.188.31|64.233.188.99|64.233.188.154|74.125.237.31|74.125.237.13|74.125.237.62|74.125.237.4|64.233.188.19|64.233.188.114|64.233.188.139|173.194.218.142|173.194.218.201|64.233.188.101|64.233.188.90|173.194.218.17|173.194.218.86|64.233.188.167|173.194.218.197|74.125.237.36|64.233.188.147|173.194.218.138|74.125.237.8|173.194.218.137|64.233.188.112|173.194.218.122|64.233.188.115|64.233.188.82|64.233.162.83|64.15.114.42|64.233.188.86|74.125.237.11|64.15.114.46|64.233.188.195|64.233.188.102|173.194.218.115|64.233.188.100|173.194.218.166|64.15.114.51|64.233.188.97|74.125.237.27|64.233.188.141|173.194.218.19|74.125.237.58|64.233.188.93|173.194.218.99|74.125.237.25|64.233.188.122" + iplist + source[pos1:]
f1.seek(0,0)
f1.truncate()
f1.write(source)
f1.close()

import os
os.remove('out.txt')
os.remove('out1.txt')
os.remove('out2.txt')
print "Update finished..."
#raw_input(unicode('按任意键启动goagent...','utf-8').encode('gbk'))
os.system(r'"goagent.exe"')
#os.system(r'"E:\Program Files\goagent-goagent-98eca96\local\goagent.exe"')
